## ADDED Requirements

### Requirement: Automated PR code review is triggered on PR open and update
When a pull request is opened or new commits are pushed to an existing PR, the system SHALL automatically trigger a Claude-powered code review via the gh-aw workflow.

#### Scenario: Review triggered on PR opened
- **WHEN** a pull request is opened against the repository
- **THEN** the gh-aw workflow starts and Claude reviews the PR diff

#### Scenario: Review triggered on PR synchronized
- **WHEN** new commits are pushed to an existing open pull request
- **THEN** the gh-aw workflow starts and Claude reviews the updated diff

### Requirement: Claude posts a structured review comment on the PR
Claude SHALL post a review comment on the pull request containing a structured analysis of the code changes.

#### Scenario: Successful review comment posted
- **WHEN** Claude completes its analysis of the PR diff
- **THEN** a comment is posted on the PR with sections covering: summary, potential issues, and suggestions

#### Scenario: Review comment identifies the automated nature
- **WHEN** the review comment is posted
- **THEN** the comment SHALL include a notice that it is an automated review generated by Claude

### Requirement: Workflow uses minimal write permissions
The gh-aw workflow SHALL be configured with only the permissions required to post a PR comment.

#### Scenario: Permissions are scoped correctly
- **WHEN** the workflow runs
- **THEN** it has `pull-requests: write` and `contents: read` permissions and no others

#### Scenario: Only add-pr-review-comment is allowed as a write operation
- **WHEN** the workflow executes safe-outputs
- **THEN** only `add-pr-review-comment` is permitted; PR close, merge, and branch changes are not allowed

### Requirement: Workflow lock file is committed to the repository
The compiled `.lock.yml` file SHALL be committed to the repository alongside the `.md` instruction file.

#### Scenario: Both files exist in the repository
- **WHEN** the change is merged
- **THEN** both `.github/workflows/pr-review.md` and `.github/workflows/pr-review.lock.yml` are present in the repository

#### Scenario: Lock file is regenerated after instruction changes
- **WHEN** the `.md` instruction file is modified
- **THEN** the developer runs `gh aw compile pr-review` and commits the updated `.lock.yml`

### Requirement: Setup steps are documented in the README
The README SHALL document the steps required to enable the automated PR review workflow.

#### Scenario: README covers Secret configuration
- **WHEN** a developer reads the README
- **THEN** they can find clear instructions for adding `ANTHROPIC_API_KEY` to GitHub Secrets

#### Scenario: README covers gh CLI and gh-aw installation
- **WHEN** a developer reads the README
- **THEN** they can find instructions for installing GitHub CLI and the gh-aw extension needed to recompile the workflow
